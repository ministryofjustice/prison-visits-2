generic-service:
  image:
    repository: 754256621582.dkr.ecr.eu-west-2.amazonaws.com/prison-visits-booking/prison-visits-staff
    pullPolicy: IfNotPresent
    port: 3000

  containerCommand: ["sh", "-c", "bundle exec puma -p 3000 -C ./config/puma_prod.rb --pidfile /tmp/server.pid"]

  fullnameOverride: "prison-visits-booking-staff"

  service:
    enabled: true
    type: ClusterIP
    port: 3000

  ingress:
    enabled: true
    # host: app-hostname.local # override per environment
    # tlsSecretName: hmpps-template-typescript-cert

  livenessProbe:
    httpGet:
      path: /ping

  readinessProbe:
    httpGet:
      path: /ping

  custommetrics:
    enabled: true
    scrapeInterval: 15s
    metricsPath: /metrics
    metricsPort: 9394

  envFrom:
    - configMapRef:
        name: shared-environment
    - secretRef:
        name: secrets

  namespace_secrets:
    prison-visits-rds-instance-output:
      DATABASE_URL: url
    elasticache-redis:
      REDIS_URL: url
    hmpps-auth-secrets:
      NOMIS_USER_OAUTH_CLIENT_ID: NOMIS_USER_OAUTH_CLIENT_ID
      NOMIS_USER_OAUTH_CLIENT_SECRET: NOMIS_USER_OAUTH_CLIENT_SECRET
    secrets:
      NOMIS_OAUTH_CLIENT_ID: NOMIS_OAUTH_CLIENT_ID
      NOMIS_OAUTH_CLIENT_SECRET: NOMIS_OAUTH_CLIENT_SECRET

  extraContainers:
    - name: prison-visits-booking-staff-sidekiq
      image: 754256621582.dkr.ecr.eu-west-2.amazonaws.com/prison-visits-booking/prison-visits-staff
      imagePullPolicy: IfNotPresent
      command: ['sh', '-c', "bundle exec sidekiq -C config/sidekiq.yml"]
      env:
        - name: "SCRIPT_NAME"
          value: "/sidekiq-admin"
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: prison-visits-rds-instance-output
              key: url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: elasticache-redis
              key: url
      envFrom:
        - configMapRef:
            name: shared-environment
        - secretRef:
            name: secrets


  allowlist:
    groups:
      - internal

generic-prometheus-alerts:
  targetApplication: prison-visits-booking-staff
