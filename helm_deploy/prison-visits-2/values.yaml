image:
  repository: &repository 754256621582.dkr.ecr.eu-west-2.amazonaws.com/prison-visits-booking/prison-visits-staff:latest

generic-service:
  nameOverride: prison-visits-booking-staff

  image:
    repository: *repository
    pullPolicy: Always
    port: 3000
    containerCommand: ['sh', '-c', "bundle exec puma -p 3000 -C ./config/puma_prod.rb --pidfile /tmp/server.pid"]

  service:
    enabled: true
    type: ClusterIP
    port: 3000

  ingress:
    enabled: true
    # host: app-hostname.local # override per environment
    # tlsSecretName: hmpps-template-typescript-cert

  livenessProbe:
    httpGet:
      path: /ping

  readinessProbe:
    httpGet:
      path: /ping

  custommetrics:
    enabled: true
    scrapeInterval: 15s
    metricsPath: /metrics
    metricsPort: 9394

  envFrom:
    - configMapRef:
        name: shared-environment
    - secretRef:
        name: secrets

  namespace_secrets:
    prison-visits-rds-instance-output:
      DATABASE_URL: url
    elasticache-redis:
      REDIS_URL: url
    hmpps-auth-secrets:
      NOMIS_USER_OAUTH_CLIENT_ID: NOMIS_USER_OAUTH_CLIENT_ID
      NOMIS_USER_OAUTH_CLIENT_SECRET: NOMIS_USER_OAUTH_CLIENT_SECRET
    secrets:
      NOMIS_OAUTH_CLIENT_ID: NOMIS_OAUTH_CLIENT_ID
      NOMIS_OAUTH_CLIENT_SECRET: NOMIS_OAUTH_CLIENT_SECRET

  extraContainers:
    - name: prison-visits-booking-staff-sidekiq
      image: *repository
      imagePullPolicy: Always
      ports:
        - name: http
          containerPort: 3000
          protocol: TCP

  allowlist:
    internal: "165.225.81.49/32,172.22.16.3,18.132.131.80,185.40.10.8/29,194.33.192.0/25,194.33.193.0/25,194.33.196.0/25,194.33.197.0/25,194.33.248.0/29,194.33.248.0/29,194.33.249.0/29,194.33.249.0/29,194.73.161.50/32,195.188.22.0/27,195.188.22.128/27,195.27.188.37,195.59.215.184/29,195.59.75.0/24,195.89.14.37,195.89.157.56/29,195.89.175.213/32,195.89.175.229/32,195.92.38.20/32,195.92.38.21/32,195.92.38.21/32,195.92.38.22/32,195.92.38.23/32,20.49.214.199/32,20.49.214.228/32,212.137.36.230/32,212.139.143.66/32,212.250.136.96/27,212.74.97.221/32,213.106.80.32/27,213.121.161.112/28,217.161.76.184/29,217.161.76.192/29,217.161.76.186/32,217.161.76.187/32,217.161.76.194/32,217.161.76.195/32,217.22.14.0/24,217.33.148.210/32,217.41.68.40,3.8.51.207/32,35.176.93.186/32,35.177.125.252/32,35.177.137.160/32,35.177.252.195/32,35.177.252.54/32,35.178.209.113/32,37.26.90.144/29,5.153.255.210/32,51.148.47.137/32,51.148.9.201,51.149.249.0/29,51.149.249.0/29,51.149.249.32/29,51.149.249.32/29,51.149.250.0/24,51.149.250.0/24,51.149.251.0/24,51.155.55.241/32,51.155.85.249/32,51.179.196.131/32,51.179.197.1/32,51.179.197.16/28,51.231.157.126,51.231.157.222,51.231.157.226,51.247.3.0/24,51.247.4.0/24,52.209.186.226,52.209.34.226,52.210.232.124,52.48.244.35,52.56.112.98/32,52.56.118.154/32,52.56.62.0/24,52.57.132.90,52.59.147.246,54.229.117.192,62.25.109.197/32,62.252.202.50/32,62.253.83.37/32,80.100.176.162,80.193.114.10,80.193.128.200/32,80.193.134.32/32,80.194.71.110/32,80.86.46.16/32,80.86.46.17/32,80.86.46.18/32,81.134.202.29/32,81.144.174.115/32,81.144.241.238/32,83.151.219.160/29,87.81.252.58,88.98.48.10/32,20.26.11.71/32,20.26.11.108/32"

generic-prometheus-alerts:
  targetApplication: prison-visits-booking-staff
